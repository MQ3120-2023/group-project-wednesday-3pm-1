# Using MongoDB
* So far: we have been using in memory storage, and we are moving to a real database
* MongoDB: stores JSON Documents -> which fits well with our web application as it uses JSON data 
* We will store all the array of objects in the `data.json` file in the database 
* Cluster0 -> our database store 

# Connecting to the database 
- URL format is different 
- Loaded some data to the database 
- node server/ingestdb.js

# Integerating the Express Server and the Database
- We want to ensure the express server gets the data from the database, rather than the  `data.json` file, (see api.js in controllers folder) 
# Express Application Structure
## How They Connect:
### `server.js` → `app.js`:
- The `server.js` file imports the app (Express application) from `app.js` with the line:
  ```javascript
  const app = require('./app');
  ```
- This means the server setup and configuration we did in `app.js` is being used to start and run the server in `server.js`.

### `app.js` → `api.js`:
- The `app.js` file imports the `apiRouter` from `api.js` with the line:
  ```javascript
  const apiRouter = require("./controllers/api");
  ```
- It then uses this router with the line:
  ```javascript
  app.use(apiRouter);
  ```
  Which means all the routes we defined in `api.js` are now active and part of your server's route handling whenever a particular request is made by the client.

# Linking to the server Routes 
- Connect our database to the routes we have in the Express server - so we can retrieve data from it and put data into our store 

## Express Server vs. MongoDB Database

### Express Server
- **Purpose**: Handle and respond to HTTP requests from clients.
- **Key Roles**:
  - **Request Handling**: Listen and respond to incoming requests from clients.
  - **Middleware Management**: Use middleware for tasks like parsing incoming data, authentication, and logging.
  - **Routing**: Determine how the application responds based on the request's endpoint and method.
  - **Integration**: Can integrate with databases (like MongoDB) to fetch or store data based on client requests.

### MongoDB Database
- **Purpose**: Persistently store and manage application data.
- **Key Roles**:
  - **Data Storage**: Maintain application data in a structured or semi-structured format.
  - **CRUD Operations**: Offer capabilities to Create, Read, Update, and Delete data.
  - **Scalability**: Support application growth by scaling to handle larger datasets and more traffic.
  - **Data Modeling**: Allow flexible data structures and relationships to support various application needs.

### Interaction
1. A user interacts with the web application, triggering an HTTP request.
2. The Express server processes this request, parsing data, and deciding the appropriate action.
3. If needed, Express communicates with the MongoDB database to retrieve, modify, or store data.
4. After processing, Express sends an appropriate response back to the client.

# Issues to tackle for the future, written 9/10/23
- Everytime the application is run, does the ingestion process (ingesting data from data.json to mongodb database) happen over and over again? resulting in duplicate values?
    - I do not thing the ingestdb.js script is part of running the main react application 
    - only if you do `node server/ingestdb.js`, the ingestdb.js script is executed and the data from data.json is ingested into the database again -> which will result in duplicate values unless handled correctly using findOne -> for now using postTitle, but will use _id field soon
- How to make use of the "id" field generated by mongodb - causing Circular reference right now
- Order of data being ingested into mongodb
- create a "userRoute.js" file in controllers to modularise route handlers involving users (Ryan's route handlers)
- Work on password handling and authentication


## TechNews Feature
- Fetching News from a Third Party API

### Frontend (React)

- `const[news, setNews] = useState([])`: We using React's `useState` hook to manage the state of `news`, which will hold the array of news data. It's initially set to an empty array.

- `axios.get(baseurl)`: This makes an HTTP GET request to `/api/techNews`, which is the endpoint on our Express server.

- `.then((response) => {...})`: When the request is successful, we update the `news` state using `setNews(response.data)`.

### Backend (Express)

- `app.get('/api/techNews', (req, res) => {...})`: Our Express server listens for GET requests at the `/api/techNews` endpoint.

- `axios.get(apiURL, {...})`: The server makes another HTTP GET request, this time to a third-party API. It includes an API key in the request header for authentication.

- `.then(newsArray => {...})`: If the request to the third-party API is successful, the server sends the received data back to the React frontend using `res.json(newsArray.data)`.

- `.catch(error => {...})`: If the server fails to fetch data from the third-party API, it will return a 404 status and send an error message.

The flow of data is as follows:

1. React frontend makes a request to Express backend.
2. Express backend makes a request to a third-party API.
3. Third-party API returns data to Express backend.
4. Express backend returns data to React frontend.
5. The frontend then updates its state based on this returned data.


## Issues + possible ideas with the News Feature 
- env way not working for API_KEY
- when you first search for a topic in the search bar, works fine, but after some articles are loaded, putting another topic in the search bar and clicking on the search button does not change the articles 
  - setting the news array should reset everything, but new articles are being added to the array instead of replacing it
- going back to application from a news article brings back blank page with search bar, a way to take user back to where they first clicked the link (Use React Router's state for that) / `Local Storage/Session Storage!!!!/ Server-Side Caching`
- /api/techNews end point gives cannot fetch but things load just fine on front end
- Maybe have topics they can click from?
- Allow Filter by country?


